## 클린 아키텍쳐 이해 & 시나리오 분석

- 클린 아키텍처 개념과 레이어드 아키텍처 비교
- 시나리오 요구사항 분석 및 milestone 수립
- 도메인 모델 분리 계획 수립

### 클린 아키텍처

- 핵심 개념: 의존성 규칙(Dependency rule)에 따라 안쪽 도메인 계층이 바깥 인프라 계층에 의존하지 않음
- 계층 구성
  - Entities (도메인)
  - Use Cases
  - Interface Adapters(컨트롤러, 프레젠터)
  - Frameworks, Drivers(DB, UI)
- 의존성의 흐름: 안쪽 -> 바깥쪽 흐름 금지
- 장점
  - 도메인 독립성 유지
  - 테스트 용이
  - 변화에 유연함
- 단점
  - 복잡성 증가
  - 초반 설계비용 높음

### 레이어드 아키텍처

- 핵심 개념: 계층 간 수직 의존성을 전제로한 구조(Controller -> Service -> Repository)
- 계층 구성
  - Presentation Layer
  - Application Layer
  - Domain Layer
  - Infrastructure Layer
- 의존성 흐름: 상위 계층이 하위 계층에 의존하는 형태(OOP의 일반적 DI 활용)
- 장점
  - 학습 및 설계가 비교적 쉬움
  - 단순 서비스에 적합
- 단점
  - 도메인 로직 침투 위험
  - 테스트 및 확장 어려움

### SOLID 원칙
SOLID는 객체지향 설계의 5가지 원칙으로, 클린 아키텍처의 핵심 개념과 직결됩니다.

- SRP (단일 책임 원칙)
  - 하나의 클래스는 하나의 책임만 가져야 한다.
  - 도메인, 유스케이스, 컨트롤러 등을 분리하여 책임을 명확히 함.

- OCP (개방-폐쇄 원칙)
  - 확장에는 열려있고 변경에는 닫혀있어야 한다.
  - 인터페이스 기반 설계, 전략 패턴, DI 등을 통해 구현.

- LSP (리스코프 치환 원칙)
  - 하위 클래스는 상위 타입을 대체할 수 있어야 한다.
  - 타입 안정성과 인터페이스 일관성을 유지.

- ISP (인터페이스 분리 원칙)
  - 클라이언트는 사용하지 않는 인터페이스에 의존하면 안 된다.
  - 인터페이스는 작고 명확해야 함.

- DIP (의존 역전 원칙)
  - 상위 모듈이 하위 모듈에 의존하지 않도록, 추상화에 의존해야 함.
  - 클린 아키텍처의 핵심 원칙이며, 인프라가 도메인을 참조하지 않고 인터페이스를 통해 연결됨.

### 도메인 모델링

비즈니스 규칙과 개념을 코드로 표현하는 작업이며, 가장 안쪽의 계층에서, 외부 변화에 영향을 받지 않아야 합니다.

- 도메인 모델링 구성 요소
  - Entity: ID 등으로 구분되는 식별 가능한 객체, 상태를 갖고 변경이 가능함
  - Value Object: 고유 식별자 없이 값으로만 비교되는 객체, 불변적으로 다루는 것이 일반적
  - Aggregate: 엔티티와 값 객체를 하나의 논리적 단위로 묶은 것.
  - Domain Service: 엔티티 만으로 선언하기 어려운, 복잡한 도메인 로직(비즈니스), 외부 연동
  - Domain Event: 도메인에 발생한 사건, 도메인에 다른 애그리거트와 느슨하게 결합되어 연계

- Rich Domain Model 지향
  - 도메인을 단순 데이터만 담긴 저장소 처럼 사용하는 것이 아니라, 핵심 로직을 직접 처리하도록 하는 형태를 지향
  - 로직을 모두 Service에 뭉쳐 놓는 것이 아닌, 객체가 스스로 로직을 처리

## 요구사항 분석

- 기능 요건 정리
  - 1️⃣ 상품 조회(목록, 상세) 시, 상품의 상세 정보와 재고를 반환해야 한다.
    - 사용자에게 상품 목록을 제공해야한다.
    - 사용자에게 상품 별 상세 정보를 제공해야한다.
    - 상세 정보에는 이름과 가격, 재고를 포함한다.
  - 2️⃣ 주문/결제 시, 재고 확인, 재고 차감, 잔액 확인(+ 쿠폰 사용 시), 결제 처리가 되어야 한다.
    - 사용자는 상품(들)을 선택하고 주문을 요청할 수 있다.
    - 주문 요청 시 재고를 확인하고, 잔액 및 쿠폰 적용 여부에 따른 할인액을 확인할 수 있다.
    - 결제 성공 시 재고가 정상적으로 차감되어야 한다.
    - 결제 성공 시 주문은 주문 완료 상태가 되어야 한다. 
  - 3️⃣ 포인트 충전 및 사용이 되어야 한다.
    - 사용자는 포인트를 충전할 수 있다.
    - 상품의 구매 시 포인트가 사용되어야 한다.

- 비기능 요건 정리
  - 결제 실패 시 재고와 포인트는 트랜잭션 단위로 복구 되어야 한다.
  - 포인트에 대한 충전 및 사용은 로그에 기록되어야 한다.
  - 모든 유즈 케이스는 `Mock Repository`로 테스트가 가능해야 한다.
  - 외부 API 연동은 인터페이스로 분리되어 `Stub`으로 대체할 수 있어야 한다.
